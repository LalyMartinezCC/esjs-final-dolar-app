importar { Terminal } desde "@es-js/terminal";
importar { obtenerJson } desde "https://desarrollo-aplicaciones.vercel.app/2024/code/obtener-json.js";
importar { validarSecreto } desde "https://desarrollo-aplicaciones.vercel.app/2024/code/validar-secreto.js";
importar { format, parseISO } desde "npm/date-fns/+esm";

const DNI = "33339046"; // Ingresa tu DNI aquÃ­ ðŸ‘ˆ

asincrono funcion inicio() {
  mientras (verdadero) {
    Terminal.escribir("Hola! Ingresa la palabra secreta:");
    const secreto = esperar Terminal.leer();

    si (esperar validarSecreto(DNI, secreto)) {
      mostrarConfeti();  // Llamada a la nueva funciÃ³n
      esperar mostrarCotizacion();
    } sino {
      Terminal.escribir("Palabra secreta invÃ¡lida");
    }

    Terminal.escribir("Presiona ENTER para volver a ingresar o CTRL+C para salir.");
    esperar Terminal.leerEnter();
    Terminal.limpiar();
  }
}

funcion mostrarConfeti() {
  Terminal.escribir("ðŸŽ‰ðŸŽ‰ Â¡Felicidades! ðŸŽ‰ðŸŽ‰");
  Terminal.escribir("âœ¨ Has ingresado la palabra secreta correcta. âœ¨");
  Terminal.escribir("ðŸ’µ A continuaciÃ³n, te proporcionamos el detalle de la cotizaciÃ³n del dÃ³lar blue, incluyendo su precio de venta, precio de compra y el promedio. ðŸ’µ");
}

asincrono funcion mostrarCotizacion() {
  const cotizacion = esperar obtenerJson("https://dolarapi.com/v1/dolares/blue");

  si (cotizacion) {
    const { venta, compra, fechaActualizacion } = cotizacion;
    const promedio = (venta + compra) / 2;

    // Verificamos que `fechaActualizacion` estÃ© definida y en formato ISO antes de formatear
    mut fechaFormateada = "Fecha no disponible";
    si (fechaActualizacion) {
      intentar {
        fechaFormateada = format(parseISO(fechaActualizacion), "dd/MM/yyyy");
      } capturar (error) {
        consola.error("Error al formatear la fecha:", error);
      }
    }

    Terminal.escribir(`CotizaciÃ³n del DÃ³lar Blue (${fechaFormateada}):`);
    Terminal.escribir(`- Precio de venta: $${venta}`);
    Terminal.escribir(`- Precio de compra: $${compra}`);
    Terminal.escribir(`- Promedio: $${promedio.fijarDecimales(2)}`);
  } sino {
    Terminal.escribir("No se pudo obtener la cotizaciÃ³n");
  }
}

inicio();